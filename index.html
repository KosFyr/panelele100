<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyStudyPlan - Πανελλήνιες</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            color: #333;
        }
        .container {
            background-color: #fff;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            width: 450px;
            text-align: center;
            animation: fadeIn 0.5s ease-in;
            position: relative;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        h1 {
            color: #4a00e0;
            font-size: 28px;
            margin-bottom: 25px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }
        button {
            background: linear-gradient(90deg, #8e2de2, #4a00e0);
            color: white;
            border: none;
            padding: 12px 25px;
            margin: 8px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        .coming-soon-btn {
            background: #d3d3d3;
            color: #666;
            cursor: not-allowed;
        }
        .coming-soon-btn:hover {
            transform: none;
            box-shadow: none;
        }
        input {
            width: 80%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
        }
        #login-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 8px 15px;
            font-size: 14px;
        }
        #timer {
            color: #ffcc00;
            font-size: 20px;
            font-weight: bold;
            margin: 15px 0;
            background: rgba(255, 204, 0, 0.1);
            padding: 5px 10px;
            border-radius: 5px;
        }
        #progress {
            font-size: 18px;
            color: #4a00e0;
            margin-bottom: 15px;
        }
        .answer-btn {
            width: 120px;
            margin: 10px;
        }
        .correct {
            background: #28a745 !important;
            box-shadow: 0 0 10px rgba(40, 167, 69, 0.5);
        }
        .wrong {
            background: #dc3545 !important;
            box-shadow: 0 0 10px rgba(220, 53, 69, 0.5);
        }
        #question {
            font-size: 18px;
            margin: 20px 0;
            line-height: 1.4;
        }
        #next-btn {
            background: #ffcc00;
            color: #333;
        }
        #feedback {
            font-size: 20px;
            color: #4a00e0;
            margin: 20px 0;
            font-weight: bold;
        }
        #back-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ff4444;
            padding: 8px 15px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container" id="app">
        <!-- Home Screen -->
        <div id="home-screen">
            <h1>MyStudyPlan</h1>
            <button onclick="navigate('math')">Μαθηματικά</button>
            <button class="coming-soon-btn" onclick="navigate('aoth')">ΑΟΘ</button>
            <button class="coming-soon-btn" onclick="navigate('aepp')">ΑΕΠΠ</button>
            <button id="login-btn" onclick="navigate('login-screen')">Σύνδεση/Εγγραφή</button>
        </div>

        <!-- Login Screen -->
        <div id="login-screen" style="display: none;">
            <h1>Σύνδεση</h1>
            <input type="email" id="email-login" placeholder="Email" required>
            <input type="password" id="password-login" placeholder="Κωδικός" required>
            <button onclick="login()">Σύνδεση</button>
            <button onclick="navigate('register-screen')">Δημιουργία Λογαριασμού</button>
            <button onclick="navigate('home')">Επιστροφή</button>
        </div>

        <!-- Register Screen -->
        <div id="register-screen" style="display: none;">
            <h1>Εγγραφή</h1>
            <input type="text" id="username-register" placeholder="Username" required>
            <input type="email" id="email-register" placeholder="Email" required>
            <input type="password" id="password-register" placeholder="Κωδικός" required>
            <select id="role-register" required>
                <option value="" disabled selected>Επιλέξτε ρόλο</option>
                <option value="teacher">Δάσκαλος</option>
                <option value="student">Μαθητής</option>
            </select>
            <button onclick="register()">Εγγραφή</button>
            <button onclick="navigate('login-screen')">Επιστροφή στη Σύνδεση</button>
        </div>

        <!-- Μενού Μαθηματικών -->
        <div id="math-menu" style="display: none;">
            <h1>Μαθηματικά</h1>
            <button onclick="navigate('quiz-options')">Σωστό / Λάθος</button>
            <button class="coming-soon-btn" onclick="navigate('theorems')">Θεωρήματα</button>
            <button class="coming-soon-btn" onclick="navigate('proofs')">Αποδείξεις</button>
            <button onclick="navigate('home')">Επιστροφή</button>
        </div>

        <!-- Επιλογές Quiz -->
        <div id="quiz-options" style="display: none;">
            <h1>Σωστό / Λάθος</h1>
            <button onclick="startRandomQuiz()">Τεστ 10 Ερωτήσεων</button>
            <button onclick="navigate('units')">Τεστ ανά Ενότητα</button>
            <button onclick="navigate('math')">Επιστροφή</button>
        </div>

        <!-- Ενότητες -->
        <div id="units" style="display: none;">
            <h1>Ενότητες</h1>
            <button onclick="startUnitQuiz('functions')">Συναρτήσεις</button>
            <button onclick="startUnitQuiz('limits')">Όρια</button>
            <button onclick="startUnitQuiz('continuity')">Θεωρήματα Συνέχειας</button>
            <button onclick="startUnitQuiz('derivatives')">Παράγωγος</button>
            <button onclick="navigate('quiz-options')">Επιστροφή</button>
        </div>

        <!-- Coming Soon Σελίδα -->
        <div id="coming-soon" style="display: none;">
            <h1>Coming Soon</h1>
            <button onclick="navigate('home')">Επιστροφή</button>
        </div>

        <!-- Quiz Σωστό / Λάθος -->
        <div id="quiz-screen" style="display: none;">
            <h1>Σωστό / Λάθος</h1>
            <button id="back-btn" onclick="navigate('quiz-options')">Επιστροφή</button>
            <div id="timer">Χρόνος: 120 δευτ.</div>
            <div id="progress"></div>
            <p id="question"></p>
            <button class="answer-btn" onclick="answer(true)">ΣΩΣΤΟ</button>
            <button class="answer-btn" onclick="answer(false)">ΛΑΘΟΣ</button>
            <button id="next-btn" style="display: none;" onclick="nextQuestion()">Επόμενη Ερώτηση</button>
        </div>

        <!-- Ολοκλήρωση Quiz -->
        <div id="results-screen" style="display: none;">
            <h1>Αποτελέσματα</h1>
            <p id="score"></p>
            <p id="feedback"></p>
            <button onclick="navigate('quiz-options')">Παίξε Ξανά</button>
            <button onclick="navigate('home')">Επιστροφή στο Αρχικό Μενού</button>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyJS1zwF_STX0xFTMbSyGJEbU0QH3V5r0",
            authDomain: "mystudyplan-a0c73.firebaseapp.com",
            projectId: "mystudyplan-a0c73",
            storageBucket: "mystudyplan-a0c73.firebasestorage.app",
            messagingSenderId: "681843739955",
            appId: "1:681843739955:web:e1b2d046bedf04ae1391196"
        };

        // Initialize Firebase
        let auth;
        try {
            const app = firebase.initializeApp(firebaseConfig);
            auth = firebase.getAuth(app);
            console.log("Firebase initialized successfully");
        } catch (error) {
            console.error("Firebase initialization error:", error);
            alert("Σφάλμα κατά την αρχικοποίηση του Firebase: " + error.message);
            navigate('home'); // Default to home if initialization fails
        }

        // Register function with username and role
        function register() {
            const email = document.getElementById('email-register').value;
            const password = document.getElementById('password-register').value;
            const username = document.getElementById('username-register').value;
            const role = document.getElementById('role-register').value;

            if (!email || !password || !username || !role) {
                alert('Παρακαλώ συμπληρώστε όλα τα πεδία!');
                return;
            }

            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    // Save additional user data (username, role) to Firebase (optional, using Realtime Database or Firestore)
                    console.log("User registered:", userCredential.user.uid);
                    alert('Εγγραφή επιτυχής! Μπορείς να συνδεθείς.');
                    navigate('login-screen');
                })
                .catch((error) => {
                    alert('Σφάλμα: ' + error.message);
                });
        }

        // Login function
        function login() {
            const email = document.getElementById('email-login').value;
            const password = document.getElementById('password-login').value;
            if (!email || !password) {
                alert('Παρακαλώ συμπληρώστε όλα τα πεδία!');
                return;
            }
            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    alert('Σύνδεση επιτυχής!');
                    navigate('home');
                })
                .catch((error) => {
                    alert('Σφάλμα: ' + error.message);
                });
        }

        // Logout function
        function logout() {
            auth.signOut().then(() => {
                alert('Αποσύνδεση επιτυχής!');
                navigate('home');
            }).catch((error) => {
                alert('Σφάλμα κατά την αποσύνδεση: ' + error.message);
            });
        }

        // Check auth state
        document.addEventListener('DOMContentLoaded', () => {
            if (!auth) {
                console.error("Firebase Authentication not initialized");
                alert("Σφάλμα: Το Firebase Authentication δεν έχει αρχικοποιηθεί.");
                navigate('home');
                return;
            }

            auth.onAuthStateChanged((user) => {
                if (user) {
                    console.log("User logged in:", user.email);
                    navigate('home');
                } else {
                    console.log("No user logged in");
                    navigate('home'); // Default to home screen
                }
            }, (error) => {
                console.error("Auth state change error:", error);
                alert("Σφάλμα κατά την ελέγχο κατάστασης σύνδεσης: " + error.message);
                navigate('home');
            });
        });

        const questions = [
            { text: "Κάθε κατακόρυφη ευθεία έχει το πολύ ένα κοινό σημείο με τη γραφική παράσταση μιας συνάρτησης f.", answer: true },
            // ... (rest of the questions remain the same)
        ];

        let currentScreen = 'home';
        let currentQuestionIndex = 0;
        let score = 0;
        let timer;
        let timeLeft = 120;
        let shuffledQuestions = [];
        let totalQuestions = 0;

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function navigate(screen) {
            try {
                document.querySelectorAll('.container > div').forEach(div => div.style.display = 'none');
                const targetScreen = document.getElementById(screen === 'home' ? 'home-screen' : 
                                                             screen === 'math' ? 'math-menu' : 
                                                             screen === 'quiz-options' ? 'quiz-options' : 
                                                             screen === 'units' ? 'units' : 
                                                             screen === 'quiz' ? 'quiz-screen' : 
                                                             screen === 'results' ? 'results-screen' : 
                                                             screen === 'login-screen' ? 'login-screen' : 
                                                             screen === 'register-screen' ? 'register-screen' : 'coming-soon');
                if (targetScreen) {
                    targetScreen.style.display = 'block';
                    currentScreen = screen;
                    console.log("Navigated to:", screen);
                } else {
                    console.error("Screen not found:", screen);
                    alert("Σφάλμα: Η οθόνη " + screen + " δεν βρέθηκε!");
                }

                if (screen !== 'quiz') {
                    clearInterval(timer);
                }
            } catch (error) {
                console.error("Navigation error:", error);
                alert("Σφάλμα κατά την πλοήγηση: " + error.message);
            }
        }

        function startRandomQuiz() {
            try {
                shuffledQuestions = shuffleArray([...questions]).slice(0, 10);
                totalQuestions = 10;
                currentQuestionIndex = 0;
                score = 0;
                timeLeft = 120;
                navigate('quiz');
                showQuestion();
                startTimer();
            } catch (error) {
                console.error("Error starting random quiz:", error);
                alert("Σφάλμα κατά την έναρξη του quiz: " + error.message);
            }
        }

        function startUnitQuiz(unit) {
            try {
                if (unit === 'functions') {
                    shuffledQuestions = shuffleArray(questions.slice(0, 25));
                    totalQuestions = 25;
                } else if (unit === 'limits') {
                    shuffledQuestions = shuffleArray(questions.slice(25, 51));
                    totalQuestions = 26;
                } else if (unit === 'continuity') {
                    shuffledQuestions = shuffleArray(questions.slice(51, 61));
                    totalQuestions = 10;
                } else if (unit === 'derivatives') {
                    shuffledQuestions = shuffleArray(questions.slice(61, 99));
                    totalQuestions = 38;
                }
                currentQuestionIndex = 0;
                score = 0;
                timeLeft = 120;
                navigate('quiz');
                showQuestion();
                startTimer();
            } catch (error) {
                console.error("Error starting unit quiz:", error);
                alert("Σφάλμα κατά την έναρξη του quiz: " + error.message);
            }
        }

        function startTimer() {
            try {
                clearInterval(timer);
                timer = setInterval(() => {
                    timeLeft--;
                    document.getElementById('timer').textContent = `Χρόνος: ${timeLeft} δευτ.`;
                    if (timeLeft <= 0) {
                        clearInterval(timer);
                        nextQuestion();
                    }
                }, 1000);
            } catch (error) {
                console.error("Error in timer:", error);
                alert("Σφάλμα στον χρονοδιακόπτη: " + error.message);
            }
        }

        function showQuestion() {
            try {
                const question = shuffledQuestions[currentQuestionIndex];
                document.getElementById('question').textContent = question.text;
                document.getElementById('progress').textContent = `Ερώτηση ${currentQuestionIndex + 1}/${totalQuestions}`;
                document.getElementById('next-btn').style.display = 'none';
                const buttons = document.querySelectorAll('.answer-btn');
                buttons.forEach(btn => {
                    btn.disabled = false;
                    btn.classList.remove('correct', 'wrong');
                });
            } catch (error) {
                console.error("Error showing question:", error);
                alert("Σφάλμα κατά την εμφάνιση ερώτησης: " + error.message);
            }
        }

        function answer(userAnswer) {
            try {
                clearInterval(timer);
                const question = shuffledQuestions[currentQuestionIndex];
                const buttons = document.querySelectorAll('.answer-btn');
                buttons.forEach(btn => btn.disabled = true);
                if (userAnswer === question.answer) {
                    buttons[userAnswer ? 0 : 1].classList.add('correct');
                    score++;
                } else {
                    buttons[userAnswer ? 0 : 1].classList.add('wrong');
                    buttons[question.answer ? 0 : 1].classList.add('correct');
                }
                document.getElementById('next-btn').style.display = 'block';
            } catch (error) {
                console.error("Error in answer:", error);
                alert("Σφάλμα κατά την απάντηση: " + error.message);
            }
        }

        function nextQuestion() {
            try {
                currentQuestionIndex++;
                if (currentQuestionIndex < totalQuestions) {
                    timeLeft = 120;
                    showQuestion();
                    startTimer();
                } else {
                    endQuiz();
                }
            } catch (error) {
                console.error("Error in next question:", error);
                alert("Σφάλμα κατά την επόμενη ερώτηση: " + error.message);
            }
        }

        function endQuiz() {
            try {
                clearInterval(timer);
                navigate('results');
                document.getElementById('score').textContent = `Πέτυχες ${score}/${totalQuestions} απαντήσεις σωστά`;
                let feedback = '';
                const percentage = (score / totalQuestions) * 100;
                if (percentage >= 90) feedback = "Εξαιρετική επίδοση! Είσαι έτοιμος για τις εξετάσεις!";
                else if (percentage >= 70) feedback = "Πολύ καλά! Λίγη προσοχή ακόμα και είσαι έτοιμος!";
                else if (percentage >= 50) feedback = "Μπορείς καλύτερα! Δοκίμασε ξανά!";
                else feedback = "Χρειάζεται περισσότερη εξάσκηση! Ξαναδοκίμασε!";
                document.getElementById('feedback').textContent = feedback;
            } catch (error) {
                console.error("Error ending quiz:", error);
                alert("Σφάλμα κατά την ολοκλήρωση του quiz: " + error.message);
            }
        }
    </script>
</body>
</html>
